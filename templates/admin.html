<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel Administrativo - CETIS 54</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>

<div class="admin-container">

    <!-- HEADER -->
    <div class="admin-header">
        <h1>Panel Administrativo</h1>
        <a href="/logout" class="logout">Cerrar sesi贸n</a>
    </div>

    <!-- CONTADORES -->
    <div class="contadores">
        <div class="card pendiente">
            <span>Pendientes</span>
            <strong>{{ contadores['Pendiente'] }}</strong>
        </div>
        <div class="card revision">
            <span>En revisi贸n</span>
            <strong>{{ contadores['En revisi贸n'] }}</strong>
        </div>
        <div class="card aprobado">
            <span>Aprobados</span>
            <strong>{{ contadores['Aprobado'] }}</strong>
        </div>
        <div class="card rechazado">
            <span>Rechazados</span>
            <strong>{{ contadores['Rechazado'] }}</strong>
        </div>
    </div>

    <!-- FILTROS -->
    <div class="filters">
        <form method="GET" action="/admin">
            <label><strong>Filtrar por estatus:</strong></label>
            <select name="estatus" onchange="this.form.submit()">
                <option value="">Todos</option>
                <option value="Pendiente" {% if estatus=='Pendiente' %}selected{% endif %}>Pendiente</option>
                <option value="En revisi贸n" {% if estatus=='En revisi贸n' %}selected{% endif %}>En revisi贸n</option>
                <option value="Aprobado" {% if estatus=='Aprobado' %}selected{% endif %}>Aprobado</option>
                <option value="Rechazado" {% if estatus=='Rechazado' %}selected{% endif %}>Rechazado</option>
            </select>
        </form>

        <div class="search-box">
            <input type="text" id="buscador" placeholder=" Buscar por nombre, CURP o control...">
        </div>


        <div class="export-buttons">
            <form action="/exportar_pdf" method="GET">
                {% if estatus %}<input type="hidden" name="estatus" value="{{ estatus }}">{% endif %}
                <button type="submit" class="btn btn-pdf"> PDF</button>
            </form>

            <form action="/exportar_excel" method="GET">
                {% if estatus %}<input type="hidden" name="estatus" value="{{ estatus }}">{% endif %}
                <button type="submit" class="btn btn-excel"> Excel</button>
            </form>
        </div>
    </div>

    <!-- TABLA -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>CURP</th>
                    <th>Control</th>
                    <th>Documentos</th>
                    <th>CURP PDF</th>
                    <th>Estatus</th>
                    <th>Acci贸n</th>
                </tr>
            </thead>
            <tbody>
{% for sol in solicitudes %}
<tr>
    <td>{{ sol.nombre_completo }}</td>
    <td>{{ sol.curp }}</td>
    <td>{{ sol.numero_control }}</td>

    <td>
        <a href="/uploads/{{ sol.ruta_pdf_pago }}" target="_blank" class="btn-descarga">V谩ucher</a>
        <a href="/uploads/{{ sol.ruta_pdf_escolar }}" target="_blank" class="btn-descarga">Acad茅mico</a>
    </td>

    <td>
        <a href="/uploads/{{ sol.ruta_pdf_curp }}" target="_blank" class="btn-descarga">CURP</a>
    </td>

    <td>
        <span class="badge 
        {% if sol.estatus_tramite=='Pendiente' %}badge-pendiente
        {% elif sol.estatus_tramite=='En revisi贸n' %}badge-revision
        {% elif sol.estatus_tramite=='Aprobado' %}badge-aprobado
        {% elif sol.estatus_tramite=='Rechazado' %}badge-rechazado
        {% endif %}">
            {{ sol.estatus_tramite }}
        </span>
    </td>

    <td>
        <form action="/actualizar_estatus" method="POST">
            <input type="hidden" name="id" value="{{ sol.id }}">
            <select name="estatus" onchange="this.form.submit()">
                <option value="Pendiente" {% if sol.estatus_tramite=='Pendiente' %}selected{% endif %}>Pendiente</option>
                <option value="En revisi贸n" {% if sol.estatus_tramite=='En revisi贸n' %}selected{% endif %}>En revisi贸n</option>
                <option value="Aprobado" {% if sol.estatus_tramite=='Aprobado' %}selected{% endif %}>Aprobado</option>
                <option value="Rechazado" {% if sol.estatus_tramite=='Rechazado' %}selected{% endif %}>Rechazado</option>
            </select>
        </form>

        <form action="/eliminar_solicitud" method="POST"
              onsubmit="return confirm('驴Seguro que deseas eliminar esta solicitud?');">
            <input type="hidden" name="id" value="{{ sol.id }}">
            <button type="submit" class="btn-eliminar">Eliminar</button>
        </form>
    </td>
</tr>
{% endfor %}
</tbody>


        </table>
    </div>

</div>

<script>
document.getElementById("buscador").addEventListener("keyup", function() {
    let filtro = this.value.toLowerCase();
    let filas = document.querySelectorAll("tbody tr");

    filas.forEach(function(fila) {
        let texto = fila.innerText.toLowerCase();

        if (texto.includes(filtro)) {
            fila.style.display = "";
        } else {
            fila.style.display = "none";
        }
    });
});
</script>


</body>
</html>
