<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel Administrativo - CETIS 54</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <h1>Gesti贸n de Egresados - Control de Duplicados</h1>
    <a href="/logout" style="float:right; color:#621132;">Cerrar sesi贸n</a>

    <form method="GET" action="/admin">
    <label for="estatus"><strong>Filtrar por estatus:</strong></label>
    
    <select name="estatus" onchange="this.form.submit()">
        <option value="">Todos</option>
        <option value="Pendiente" {% if estatus=='Pendiente' %}selected{% endif %}>Pendiente</option>
        <option value="En revisi贸n" {% if estatus=='En revisi贸n' %}selected{% endif %}>En revisi贸n</option>
        <option value="Aprobado" {% if estatus=='Aprobado' %}selected{% endif %}>Aprobado</option>
        <option value="Rechazado" {% if estatus=='Rechazado' %}selected{% endif %}>Rechazado</option>
    </select>

    <div style="display:flex; gap:20px; margin:20px 0;">
    <div><strong> Pendientes:</strong> {{ contadores['Pendiente'] }}</div>
    <div><strong> En revisi贸n:</strong> {{ contadores['En revisi贸n'] }}</div>
    <div><strong> Aprobados:</strong> {{ contadores['Aprobado'] }}</div>
    <div><strong> Rechazados:</strong> {{ contadores['Rechazado'] }}</div>
    </div>


    </form>

    <div style="margin:20px 0; display:flex; gap:10px;">
    <form action="/exportar_pdf" method="GET">
        {% if estatus %}<input type="hidden" name="estatus" value="{{ estatus }}">{% endif %}
        <button type="submit" class="btn-pdf"> Exportar PDF</button>
    </form>

    <form action="/exportar_excel" method="GET">
        {% if estatus %}<input type="hidden" name="estatus" value="{{ estatus }}">{% endif %}
        <button type="submit" class="btn-excel"> Exportar Excel</button>
    </form>
    </div>

    <table>
    <thead>
        <tr>
            <th>Nombre</th>
            <th>CURP</th>
            <th>Control</th>
            <th>Documentos</th>
            <th>Estatus</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for sol in solicitudes %}
<tr class="
{% if sol[7] == 'Pendiente' %}pendiente
{% elif sol[7] == 'En revisi贸n' %}revision
{% elif sol[7] == 'Aprobado' %}aprobado
{% elif sol[7] == 'Rechazado' %}rechazado
{% endif %}
">

            <td>{{ sol[1] }}</td>
            <td>{{ sol[2] }}</td>
            <td>{{ sol[3] }}</td>
            <td>
                <a href="/uploads/{{ sol[5] }}" target="_blank" class="btn-descarga">V谩ucher</a> |
                <a href="/uploads/{{ sol[6] }}" target="_blank" class="btn-descarga">Acad茅mico</a>
            </td>
<td><strong>{{ sol[7] }}</strong></td>
            <td>
                <form action="/actualizar_estatus" method="POST">
                    <input type="hidden" name="id" value="{{ sol[0] }}">
                    <select name="estatus" onchange="this.form.submit()">
                        <option value="Pendiente" {% if sol[7]=='Pendiente' %}selected{% endif %}>Pendiente</option>
                        <option value="En revisi贸n" {% if sol[7]=='En revisi贸n' %}selected{% endif %}>En revisi贸n</option>
                        <option value="Aprobado" {% if sol[7]=='Aprobado' %}selected{% endif %}>Aprobado</option>
                        <option value="Rechazado" {% if sol[7]=='Rechazado' %}selected{% endif %}>Rechazado</option>
                    </select>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</body>
</html>